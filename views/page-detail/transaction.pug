extends ../layout
block content
  include ../helpers/helper.js.pug
  div#wrapper
    include ../common/navbar
    div.container#content.p-sm-0.block-detail
      span.h4.content.font-weight-bold #{title}
      -if(!transactionData){
        h3.text-center Data empty
      -} else {
        .box-detail
          form
            hr
            .form-group.row
              .col-sm-4
                label.col-form-label Transaction Hash:
              .col-sm-8
                span.text-truncate.hash-tag
                  a(href="#") #{transactionData.txId}
            hr
            .form-group.row
              .col-sm-4
                label.col-form-label Status:
              .col-sm-8
                span.text-truncate.hash-tag.tx-status-success
                  i.fa.fa-check-circle.mr-1 
                  | Success
            hr
            .form-group.row
              .col-sm-4
                label.col-form-label Block:
              .col-sm-8
                span.text-truncate.hash-tag
                  a(href=`/blocks/${transactionData.blockNumber}`) #{transactionData.blockNumber}
            hr
            .form-group.row
              .col-sm-4
                label.col-form-label Timestamp:
              .col-sm-8
                  span.text-truncate.hash-tag #{transactionData.createdAt}
            hr
            .form-group.row
              -if(transactionData.token){
                .col-sm-4
                  label.col-form-label Token:
                .col-sm-8
                  span.text-truncate.hash-tag
                    a(href=`/tokens/${transactionData.tokenId}`) #{transactionData.token}
              -} else{
                .col-sm-4
                  label.col-form-label Store:
                .col-sm-8
                  span.text-truncate.hash-tag
                    a(href=`/stores/${transactionData.target.link}`) #{transactionData.store}
              -}
            hr
            .form-group.row.tx-from
              .col-sm-4
                label.col-form-label From:
              .col-sm-8#tx-from
                span.text-truncate.hash-tag
                  a(href = `/address/${transactionData.source}`)#txt-copy #{replaceAddress(transactionData.source, addressPrefix)}
                -if(transactionData.target){
                  i.far.fa-copy.tx-copy(title="Copy address to clipboard" onclick="handleCopy(this)")
                -}
                  span.text-truncate.hash-tag.font-italic#addr.font-weight-light.ml-4(style='display: none;') Copied
            hr
            .form-group.row.tx-to
              .col-sm-4
                label.col-form-label To:
              .col-sm-8#tx-to
                span.text-truncate.hash-tag
                  -if(transactionData.target.type === 'token'){
                    a(href = `/tokens/${transactionData.target.link}`)#txt-copy #{replaceAddress(transactionData.target.link, addressPrefix)}
                  -} else if(transactionData.target.type === 'store'){
                    a(href = `/stores/${transactionData.target.link}`)#txt-copy #{replaceAddress(transactionData.target.link, addressPrefix)}
                  -} else {
                    a(href = `/address/${transactionData.target.link}`)#txt-copy #{replaceAddress(transactionData.target.link, addressPrefix)}
                  -}
                -if(transactionData.target){
                  i.far.fa-copy.tx-copy(title="Copy address to clipboard" onclick="handleCopy(this)")
                -}
                  span.text-truncate.hash-tag.font-italic#addr.font-weight-light.ml-4(style='display: none;') Copied
            hr
            .form-group.row
              .col-sm-4
                label.col-form-label Amount:
              .col-sm-8
                  span.text-truncate.hash-tag #{transactionData.amount}
            hr
            .form-group.row
              .col-sm-4
                label.col-form-label Fee:
              .col-sm-8
                  span.text-truncate.hash-tag #{transactionData.fee}
            hr
            .form-group.row
              .col-sm-4
                label.col-form-label Nonce:
              .col-sm-8
                span.text-truncate.hash-tag #{transactionData.nonce}
            hr
            .form-group.row
              .col-sm-4
                label.col-form-label Signature:
              .col-sm-8#tx-signature
                span.text-truncate.hash-tag#txt-copy #{transactionData.signature}
                i.far.fa-copy.tx-copy(title="Copy signature to clipboard" onclick="handleCopy(this)")
                span.text-truncate.hash-tag.font-italic#addr.font-weight-light.ml-3(style='display: none;') Copied
            hr
            -if(transactionData.data){
              .form-group.row
                .col-sm-4
                  label.col-form-label Data:
                .col-sm-8
                  .tx-data
                    .row 
                      .col-4
                        label(style={'font-weight': '450'}).col-form-label Function:
                      .col-8
                        span.text-truncate.hash-tag #{transactionData.data.function}
                    -for(index in transactionData.data.decodedData){
                      -if(!isNaN(index)){
                        .row 
                          .col-4
                            label(style={'font-weight': '450'}).col-form-label #{`Params[${index}]`}:
                          .col-8
                            span.text-truncate.hash-tag #{`${transactionData.data.decodedData[index]}`}
                      -}
                    -}
            -}
            hr
      -}
    
    div(style={"margin-top": "50px"})
    include ../common/footer
  style.
    body {
      background-color: #f5f5f5;
    }
  script. 
    function handleCopy(element){
      const id = element.parentNode.id
      const copyText = document.querySelector(`#${id} #txt-copy`).innerText;
      const textArea = document.createElement("textarea");
      textArea.value = copyText;
      document.body.appendChild(textArea);
      textArea.select();
      document.execCommand("Copy");
      textArea.remove();
      $(`#${id} #addr`).show();
      $(`#${id} #addr`).addClass('show');
      setTimeout(function(){
        $(`#${id} #addr`).removeClass('show');
        $(`#${id} #addr`).hide();
      },2000)
    }

    