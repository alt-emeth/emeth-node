extends ../layout
block content
  include ../helpers/helper.js.pug
  div#wrapper
    include ../common/navbar
    .notifi-copy
      .alert#notifi-copy.alert-success.alert-dismissible.fade(role='alert' style='display: none;') 
        span Copied
    div.container#content.p-sm-0.token-detail.addr-detail
      .d-flex
        .h4.mb-0.content.font-weight-bold #{title}
          span.ml-1.address#txt-copy #{replaceAddress(address, addressPrefix)}
        -if(address){
          .d-flex
            div.addr-copy(data-toggle='tooltip' data-placement='top' title='Copy address to clipboard')
              i.far.fa-copy(onclick="handleCopy(this)")
        -}
        -if(address){
          .d-flex
            div.addr-copy(data-toggle='modal' data-target='#modalQrCode' title = 'Show QR code' )
              i.fa.fa-qrcode
        -}
      // Modal QR-Code
      #modalQrCode.modal.fade(tabindex='-1' role='dialog' aria-hidden='true')
        .modal-dialog(role='document')
          .modal-content
            .modal-header
              span.modal-title #{address}
              button.close(type='button' data-dismiss='modal' aria-label='Close')
                span(aria-hidden='true') &times;
            .modal-body.text-center
              img(src="../images/icons/token.png", alt="")

      -if(!addressDetail || !addressDetail.balances){
        h3.text-center Data empty
      -} else {
        .row.overview
          .col-12.col-lg-6
            .box-detail
              form
                div.h6.font-weight-bold.title Overview
                hr
                .form-group.row
                  .col-sm-4
                    label.col-form-label.font-weight-bold Balance:
                  .col-sm-8
                    span.text-truncate.hash-tag #{addressDetail.nativeTokenBalance.balance} #{addressDetail.nativeTokenBalance.symbol} &nbsp;
                -if(contract){
                  .form-group.row
                    .col-sm-4
                      label.col-form-label.font-weight-bold Contract Creator:
                    .col-sm-8
                      a.nav-link(href=`/address/${tsxContractCreator.source}`, style={'width': '45%', 'padding-left': 0}).text-truncate.hash-tag #{tsxContractCreator.source}
                      span.text-truncate.hash-tag at &nbsp;
                      a.nav-link(href=`/tx/${tsxContractCreator.txId}`, style={'width': '45%', 'padding-left': 0}).text-truncate.hash-tag #{tsxContractCreator.txId}
                -}
                      
          .col-12.col-lg-6.mt-4.mt-lg-0(style={'z-index': '1000'})
            .box-detail
              form
                div.h6.title.font-weight-bold Tokens
                hr
                .form-group.row
                  .col-sm-12
                    .btn-group
                      div.dropdown-token.dropdown-toggle(type='button' data-toggle='dropdown' aria-haspopup='true' aria-expanded='false')
                        | Tokens
                      -if(addressDetail.balances.length > 0){
                        .dropdown-menu.menu-token
                          -for(item of addressDetail.balances) {
                            .d-flex.align-items-sm-center.line-token
                              img.icon-token(src= `${item.icon || '../images/icons/token.png'}`)
                              span.ml-1.token-name(style={'white-space': 'nowrap'}) #{item.name}
                              span.token-price.ml-auto(style={'white-space': 'nowrap'}) #{item.balance} #{item.symbol}
                          -}
                      -}
        .row.content-tab.mt-5
          .col
            .box-detail
              ul.nav.nav-tabs
                li
                  a.nav-link.active(href='#transactions' data-toggle='tab') Transactions
                -if(contract){
                  li
                    a.nav-link(href='#contracts' data-toggle='tab') Contract
                  li
                    a.nav-link(href='#events' data-toggle='tab') Events
                -}
              div.tab-content
                div.active.tab-pane.table-transactions#transactions
                  div.my-3
                    div#title-transactions Latest #{total > 25 ? 25 : total} from a total of&nbsp;
                      a(href=`/txs/${address}` data-toggle='tooltip' data-placement="top" title='Click to view full list') #{total}&nbsp;
                      | transactions
                    
                  hr.mb-0
                  include ../tables/table-transactions
                -if(contract){
                  div.tab-pane#contracts
                    div.my-3
                      div.fa.fa-code &nbsp; 
                      span Contract Creation Code
                    div.box-code-contract 
                      div #{contract.code}
                  div.tab-pane#events
                    div.my-3
                      div#title-transactions Latest #{total > 25 ? 25 : total} Contract Events
                    hr.mb-0
                    include ../tables/table-events
                -}
      -}
    
    div.w-100(style={"margin-top": "50px"})
      include ../common/footer
  style.
    body {
      background-color: #f5f5f5;
    }
    
  script. 
    function handleCopy(element){
      const copyText = document.querySelector(`#txt-copy`).innerText;
      const textArea = document.createElement("textarea");
      textArea.value = copyText;
      document.body.appendChild(textArea);
      textArea.select();
      document.execCommand("Copy");
      textArea.remove();
      $(`#notifi-copy`).show();
      $(`#notifi-copy`).addClass('show');
      setTimeout(function(){
        $(`#notifi-copy`).removeClass('show');
        $(`#notifi-copy`).hide();
      },1000)
    }
